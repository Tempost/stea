generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["referentialIntegrity"]
}

datasource db {
  provider             = "mysql"
  url                  = env("DATABASE_URL")
  referentialIntegrity = "prisma"
}

generator zod {
  provider              = "zod-prisma"
  output                = "./zod"
  relationModel         = true
  modelCase             = "PascalCase"
  modelSuffix           = "Model"
  useDecimalJs          = true
  prismaJsonNullability = true
}

enum Status {
  Life
  Annual
  Renew
}

enum Type {
  Individual
  Family
  Business
}

enum JRSR {
  JR
  SR
}

enum PaymentMethod {
  PayPal
  Check
}

enum PhoneType {
  Mobile
  Home
  Business
}

model NonMemberHorseOwner {
  createdAt DateTime? @default(now())
  updatedAt DateTime? @updatedAt
  /// @zod.min(1, { message: "First Name is required" })
  firstName String    @db.VarChar(255)
  /// @zod.min(1, { message: "Last Name is required" })
  lastName  String    @db.VarChar(255)
  fullName  String    @db.VarChar(255)
  /// @zod.email({ message: "Invalid email address" })
  email     String    @db.VarChar(100)
  /// @zod.min(1, { message: "Phone number is required" })
  phone     String    @db.VarChar(15)
  phoneType PhoneType @default(Mobile)
  /// List of Horses that are linked to a member
  horses    Horse[]

  @@id([fullName])
}

model Member {
  createdAt         DateTime?    @default(now())
  updatedAt         DateTime?    @updatedAt
  /// @zod.min(1, { message: "First Name is required" })
  firstName         String       @db.VarChar(255)
  /// @zod.min(1, { message: "Last Name is required" })
  lastName          String       @db.VarChar(255)
  fullName          String       @db.VarChar(255)
  /// Field to determine who is a board member, very few
  boardMember       Boolean      @default(false)
  /// @zod.min(1, { message: "Address is required" })
  address           String       @db.VarChar(255)
  /// @zod.min(1, { message: "City is required" })
  city              String       @db.VarChar(25)
  /// @zod.min(1, { message: "State is required" })
  state             String       @db.VarChar(25)
  /// @zod.min(1, { message: "Phone Number is required" })
  phone             String       @db.VarChar(15)
  phoneType         PhoneType    @default(Mobile)
  /// @zod.email({ message: "Invalid email address" })
  email             String       @db.VarChar(100)
  comments          String?      @db.VarChar(4000)
  /// Member needs to be confirmed by boardmember from dashboard
  confirmed         Boolean      @default(false)
  currentUSEAMember Boolean      @default(false)
  /// @zod.min(1, { message: "Business name is required" })
  businessName      String?      @db.VarChar(100)
  membershipDate    DateTime?    @default(now())
  memberType        Type
  memberStatus      Status
  JRSR              JRSR
  dateOfBirth       DateTime?
  zip               Int
  useaMemberID      Int?
  payment           Payment?
  /// List of rider combinations member is apart of
  RiderCombo        RiderCombo[]
  /// List of Horses that are linked to a member
  Horse             Horse[]

  @@id([fullName])
}

// Need to update payment with CUID instead of fullname ID
model Payment {
  updatedAt     DateTime?      @updatedAt
  /// @zod.max(4000, { message: "Too many characters" })
  /// General comments about payment, might grab from paypal
  comments      String?        @db.VarChar(4000)
  member        Member         @relation(fields: [payee], references: [fullName], onDelete: Cascade, onUpdate: Cascade)
  payee         String         @id
  amountPaid    Int?
  datePaid      DateTime?
  paymentMethod PaymentMethod?
  checkNumber   Int?
}

model Horse {
  createdAt        DateTime?            @default(now())
  updatedAt        DateTime?            @updatedAt
  /// @zod.min(1, { message: "Registered horse name is required" })
  /// Registered name of the horse, unique
  horseRN          String               @id @db.VarChar(255)
  /// Barn name of the horse
  horseAKA         String?              @db.VarChar(255)
  /// Field only here becuase of seeding old members
  /// Not able to connect every member/horse back together
  notConnected     Boolean?             @default(false)
  ownerRec         NonMemberHorseOwner? @relation(fields: [owner], references: [fullName], onDelete: Cascade)
  memberOwner      Member?              @relation(fields: [memberName], references: [fullName])
  memberName       String?
  registrationDate DateTime?            @default(now())
  regType          Status
  RiderCombo       RiderCombo[]
  owner            String?
}

model TotalPoints {
  /// @zod.cuid({ message: "Invalid cuid"})
  uid         String     @id @default(cuid())
  createdAt   DateTime?  @default(now())
  updatedAt   DateTime?  @updatedAt
  division    String     @db.VarChar(20)
  totalPoints Float      @default(0)
  totalShows  Int        @default(0)
  completedHT Boolean    @default(false)
  multiVenue  Boolean    @default(false)
  rider       RiderCombo @relation(fields: [riderUid], references: [uid], onDelete: Cascade, onUpdate: Cascade)
  /// @zod.cuid({ message: "Invalid cuid"})
  riderUid    String     @unique
}

model RiderCombo {
  /// @zod.cuid()
  uid        String       @id @default(cuid())
  createdAt  DateTime?    @default(now())
  updatedAt  DateTime?    @updatedAt
  member     Member       @relation(fields: [memberName], references: [fullName], onDelete: Cascade, onUpdate: Cascade)
  horse      Horse        @relation(fields: [horseName], references: [horseRN], onDelete: Cascade, onUpdate: Cascade)
  /// @zod.min(1, { message: "Member Name is required" })
  memberName String
  /// @zod.min(1, { message: "Horse Name is required" })
  horseName  String
  shows      Show[]
  points     TotalPoints?
}

model Show {
  /// @zod.cuid({ message: "Invalid cuid"})
  uid       String       @id @default(cuid())
  createdAt DateTime?    @default(now())
  updatedAt DateTime?    @updatedAt
  /// @zod.min(1, { message: "Show name is required" })
  showName  String       @db.VarChar(150)
  /// @zod.min(1, { message: "Show type is required" })
  showType  String       @db.VarChar(10)
  /// Submitted points have yet to be review by board member
  reviewed  Boolean      @default(false)
  riders    RiderCombo[]
}
